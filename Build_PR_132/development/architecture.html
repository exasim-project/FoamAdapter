<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Contributing Guide" href="contributing.html"><link rel="prev" title="Command Line Interface" href="../usage/cli.html">
        <link rel="canonical" href="https://exasim-project.com/FoamAdapter/development/architecture.html">

    <!-- Generated with Sphinx 7.2.6 and Furo 2025.09.25 -->
        <title>Architecture - FoamAdapter documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=acfd86a5" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=6a4ff913" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">FoamAdapter  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <span class="sidebar-brand-text">FoamAdapter  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to FoamAdapter!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingStarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../goals_features.html">Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../goals_features.html#features">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci.html">Continuous Integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/cli.html">Command Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development:</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing Documentation</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/development/architecture.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">¶</a></h1>
<p>This document describes the overall architecture of FoamAdapter, including both the C++ core and Python interface components.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>FoamAdapter is designed a multi-physics simulation python-based simulation framework.
It provides a flexible and modular architecture that allows users to easily extend and customize the simulation setup.</p>
<p>The architecture provides following features to achieve the goals outlined in the <a class="reference internal" href="../goals_features.html"><span class="doc">goals and features</span></a> document:</p>
<ul class="simple">
<li><p>Easy coupling of multiple domains and physics</p></li>
<li><p>Field and model initialization based on dependency graphs</p></li>
<li><p>Modular solver design that computes the data dependencies at runtime</p></li>
<li><p>Plugin architecture for easy extension with new models and fields</p></li>
</ul>
<p>The main abstraction is that each domain has one physics module assigned to it that defines the governing equations and models for that domain.
Multiple domains can be defined with input files and the coupling between the domains is handled automatically based on the defined physics modules.</p>
<p>The following sections describe the main feature and and implementation example to give a high level overview of the architecture.
More details are provided described in the section for each feature.</p>
</section>
<section id="solver-execution-model">
<h2>Solver Execution Model<a class="headerlink" href="#solver-execution-model" title="Link to this heading">¶</a></h2>
<p>FoamAdapter defines solver behavior as a dependency-driven execution model.
Each solver declares its required fields and models, and the runtime system constructs a directed acyclic graph (DAG) to determine the correct execution order.</p>
<p>The following diagram illustrates the workflow for two common solver types for a conjugate heat transfer scenario:</p>
<pre  class="mermaid">
        %%{init: {'flowchart': { 'htmlLabels': true, 'wrap': true }}}%%
flowchart TB
    subgraph setup1 [&quot;setup &quot;]
        direction TB
        S1A[&quot;Initialize Fields&quot;]
    end

    subgraph setup2 [&quot;setup&quot;]
        direction TB
        S2A[&quot;Initialize Temperature Field&quot;]
    end

    subgraph S1 [&quot;non-thermal-fluid solver&quot;]
        direction TB
        S1C[&quot;Momentum Predictor&quot;]
        S1C --&gt; S1E[&quot;Solve Energy Equation&quot;]
        S1E --&gt; S1F[&quot;Pressure Corrector&lt;br/&gt;PISO Loop&quot;]
        S1F --&gt; S1J[&quot;Update turbulence Model&quot;]
    end

    subgraph S2 [&quot;thermal-solid solver&quot;]
        direction TB
        S2B[&quot;Solve Energy Equation&quot;] --&gt; S2D[&quot;Update Solid Properties&quot;]
    end

    setup1 --&gt; S1C
    setup2 --&gt; S2B
    S1E --&gt; S2B
    S2B --&gt; S1E
    </pre><p>The diagram shows two selected solvers: a non-thermal-fluid solver and a thermal-solid solver.
Each solver has its own setup phase and computational steps, with interactions between the two solvers for energy exchange.</p>
<p>The solution steps of each solver provide the dependencies and the runtime system constructs a DAG to determine the correct execution order based on these dependencies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@model</span><span class="p">(</span><span class="s2">&quot;fluidSolver&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DomainA</span><span class="p">:</span>
    <span class="nd">@step</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">momentum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span> <span class="k">pass</span>
    <span class="nd">@step</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">solve_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span> <span class="k">pass</span>
    <span class="nd">@step</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pressure_corrector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span> <span class="k">pass</span>
    <span class="nd">@step</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_turbulence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span> <span class="k">pass</span>

<span class="nd">@model</span><span class="p">(</span><span class="s2">&quot;solidSolver&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DomainB</span><span class="p">:</span>
    <span class="nd">@step</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">solve_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span> <span class="k">pass</span>
    <span class="nd">@step</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_solid_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
</div>
<p>A solver is defined as a class with multiple steps, each step has to declare its dependencies.
Additional models can be executed before and after each step to modify the behavior and add additional physics.</p>
<p>This allows to easily extend existing solvers with new physics without modifying the core solver implementation and promotes code reuse.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The implementation is still work in progress but only details may change.</p>
</div>
</section>
<section id="modular-solver-architecture">
<h2>Modular Solver Architecture<a class="headerlink" href="#modular-solver-architecture" title="Link to this heading">¶</a></h2>
<p>The modular solver architecture briefly touched on in the previous section is a key feature of FoamAdapter and allows for flexible composition of complex multi-physics simulations.
An example of the modular solver architecture is illustrated in the following diagram:</p>
<pre  class="mermaid">
        flowchart TD

     subgraph MAIN [&quot;Main Solver Loop&quot;]
         STEP1[&quot;Momentum Predictor&lt;br/&gt;Solve velocity equation&quot;]
         STEP2[&quot;Additional Physics Modules&quot;]
         STEP3[&quot;Pressure Corrector&lt;br/&gt;Ensure mass conservation&quot;]
         STEP4[&quot;Field Updates&lt;br/&gt;Correct U, φ, turbulence&quot;]
     end

     STEP1 --&gt; STEP2
     STEP2 --&gt; STEP3
     STEP3 --&gt; STEP4

     %% Physics Extensions (simplified)
     subgraph AddPhysics [&quot;Additional Physics Modules&quot;]
         direction TB
         POROSITY[&quot;Porosity&quot;]
         ROTATION[&quot;Rotating Reference Frame&quot;]
         BUOYANCY[&quot;Boussinesq Approximation&quot;]
     end
     POROSITY -.-&gt; STEP1
     ROTATION -.-&gt; STEP1
     BUOYANCY -.-&gt; STEP2
     BUOYANCY -.-&gt; STEP3

     style MAIN fill:#E3F2FD
     style AddPhysics fill:#E3F2FD
     style STEP1 fill:#2196F3,color:#fff
     style STEP2 fill:#FF9800,color:#fff
     style STEP3 fill:#9C27B0,color:#fff
     style STEP4 fill:#607D8B,color:#fff
    </pre><p>In this architecture, the main solver loop consists of core steps such as momentum prediction and pressure correction.
Additional physics modules (e.g., porosity, rotation, buoyancy) can be plugged into the workflow to modify the behavior of these core steps.</p>
<p>This modular design enables users to easily add or remove physics effects without altering the fundamental solver structure, promoting code reuse and maintainability.
The additional physics modules need to define their dependencies and the runtime system ensures that they are executed at the correct point in the solver loop.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>implementation is still work in progress</p>
</div>
</section>
<section id="field-and-model-initialization">
<h2>Field and Model Initialization<a class="headerlink" href="#field-and-model-initialization" title="Link to this heading">¶</a></h2>
<p>As the fields and solver needs to be initialized in the correct order before the solver run, FoamAdapter provides a structured initialization phase to ensure that the necessary fields and models are properly set up.</p>
<p>The fields and models are stored lazily at first with the dependencies and a DAG is solved to determine the correct initialization order.</p>
<img alt="DAG of field and model dependencies for pimpleFoam" class="align-center" src="../_images/pimpleDag.png" />
<p>The following code snippet illustrates how a turbulence model and a derived field (face velocity) are defined with their dependencies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TurbulenceModel</span><span class="p">:</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="s2">&quot;singlePhaseTransportModel&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Incompressible turbulence model&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">)</span>
        <span class="n">singlePhaseTransportModel</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="s2">&quot;singlePhaseTransportModel&quot;</span><span class="p">)</span>
        <span class="n">turbulence</span> <span class="o">=</span> <span class="n">incompressibleTurbulenceModel</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">singlePhaseTransportModel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">turbulence</span>


<span class="nd">@fields</span><span class="o">.</span><span class="n">Fields</span><span class="o">.</span><span class="n">deps</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_face_velocity</span><span class="p">(</span><span class="n">deps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">surfaceScalarField</span><span class="p">:</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">)</span>
    <span class="n">phi_field</span> <span class="o">=</span> <span class="n">createPhi</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">surfaceScalarField</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">phi_field</span><span class="p">,</span>
        <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Face flux field&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The same approach is used for all fields and models in FoamAdapter, ensuring a consistent and reliable initialization process.</p>
</section>
<section id="plugin-architecture">
<h2>Plugin Architecture<a class="headerlink" href="#plugin-architecture" title="Link to this heading">¶</a></h2>
<section id="motivation">
<h3>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h3>
<p>Modern scientific and engineering workflows require flexible simulation frameworks that can be easily extended and customized.
FoamAdapter’s plugin architecture is designed to enable users and developers to add new physics models, boundary conditions, and solver modules without modifying the core codebase.
This approach promotes maintainability, collaboration, and rapid prototyping of new features.</p>
</section>
<section id="concept">
<h3>Concept<a class="headerlink" href="#concept" title="Link to this heading">¶</a></h3>
<p>FoamAdapter implements a runtime-extensible plugin/config system using Pydantic discriminated unions and a registry pattern.
The core idea is to allow new plugin types (e.g., models, fields, solvers) to be registered dynamically, either at runtime or via Python entry points (setuptools).
Each plugin type (such as physics models or boundary conditions) is managed by a registry, which collects all available plugin classes and exposes a unified configuration model for input validation and schema generation.</p>
<p><strong>Background: Pydantic Discriminated Unions</strong></p>
<p>Pydantic supports discriminated unions for type-safe configuration, but the set of types in the union must be known at model definition time. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">pet_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span>
    <span class="n">meows</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">pet_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;dog&#39;</span><span class="p">]</span>
    <span class="n">barks</span><span class="p">:</span> <span class="nb">float</span>

<span class="k">class</span> <span class="nc">Lizard</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">pet_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;reptile&#39;</span><span class="p">,</span> <span class="s1">&#39;lizard&#39;</span><span class="p">]</span>
    <span class="n">scales</span><span class="p">:</span> <span class="nb">bool</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">pet</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">,</span> <span class="n">Lizard</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">discriminator</span><span class="o">=</span><span class="s1">&#39;pet_type&#39;</span><span class="p">)</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This works well for static unions, but it is not possible to add new types to the union at runtime. This is a challenge for plugin systems, where extensibility is required.</p>
<p><strong>How FoamAdapter Solves This</strong></p>
<p>Plugins are registered using a decorator-based API, making it easy for users to define and integrate new modules.
Whenever a new plugin is registered, the system automatically rebuilds the Pydantic model for the plugin type, updating the discriminated union to include all registered types.
This means that the configuration model always reflects the current set of available plugins, and input validation is always up to date.</p>
<p>For example, after registering a new shape plugin, you can immediately use the updated model for validation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ShapeBase</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TriangleConfig</span><span class="p">)</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">ShapeBase</span><span class="o">.</span><span class="n">plugin_model</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shape_type&quot;</span><span class="p">:</span> <span class="s2">&quot;triangle&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">},</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This dynamic rebuilding of the model enables true runtime extensibility and ensures that input validation and schema generation always match the available plugins.
The <cite>plugin_model</cite> attribute needs to be called to obtain the up-to-date model for the plugin type.</p>
</section>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h3>
<p>To add a new plugin, users simply define a new Python class for their model or field and register it with the appropriate base class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">foamadapter.core.plugin_system</span> <span class="kn">import</span> <span class="n">PluginSystem</span>

<span class="nd">@PluginSystem</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">discriminator_variable</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">discriminator</span><span class="o">=</span><span class="s2">&quot;model_type&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ModelBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@ModelBase</span><span class="o">.</span><span class="n">register</span>
<span class="k">class</span> <span class="nc">MyCustomModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;custom&quot;</span><span class="p">]</span>
    <span class="n">parameter</span><span class="p">:</span> <span class="nb">float</span>

<span class="c1"># Instantiate a model config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">ModelBase</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="mf">1.23</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Plugins can also be discovered and registered automatically via Python entry points, allowing third-party packages to extend FoamAdapter seamlessly.
The unified configuration model and schema make it easy to build UIs, validate inputs, and document available plugins.</p>
</section>
</section>
<section id="model-introspection-and-schema-generation">
<h2>Model Introspection and Schema Generation<a class="headerlink" href="#model-introspection-and-schema-generation" title="Link to this heading">¶</a></h2>
<p>Model configuration and validation in FoamAdapter are implemented using Pydantic, which provides native support for input validation and automatic JSON Schema generation.
This mechanism forms the basis for model discovery, UI integration, and automated documentation across the framework.</p>
<p>Pydantic’s schema generation enables the following functionality:</p>
<ul class="simple">
<li><p>Input validation: Ensures model configurations are consistent and type-safe.</p></li>
<li><p>UI integration: Allows user interfaces to be generated dynamically from model definitions.</p></li>
<li><p>Automatic documentation: Exposes field names, types, and constraints for all models.</p></li>
<li><p>Metadata generation: Facilitates downstream tools to query and reason about model structures.</p></li>
<li><p>AI-assisted workflows: Supports schema-driven interactions with generative AI systems.</p></li>
</ul>
<p>To obtain a model’s JSON Schema representation, use the model_json_schema() method provided by Pydantic:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For a registered plugin or configuration model</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">ShapeBase</span><span class="o">.</span><span class="n">plugin_model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span>

<span class="c1"># For any Pydantic model</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span>
</pre></div>
</div>
<p>This interface provides a uniform mechanism for introspection of all models in FoamAdapter, making it possible to programmatically discover available fields, their data types, validation rules, and default values.</p>
<p>This requires that all plugin, solver, or model use Pydantic to configure the inputs.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="contributing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Contributing Guide</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../usage/cli.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Command Line Interface</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, FoamAdapter authors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Architecture</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#solver-execution-model">Solver Execution Model</a></li>
<li><a class="reference internal" href="#modular-solver-architecture">Modular Solver Architecture</a></li>
<li><a class="reference internal" href="#field-and-model-initialization">Field and Model Initialization</a></li>
<li><a class="reference internal" href="#plugin-architecture">Plugin Architecture</a><ul>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#concept">Concept</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#model-introspection-and-schema-generation">Model Introspection and Schema Generation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    </body>
</html>